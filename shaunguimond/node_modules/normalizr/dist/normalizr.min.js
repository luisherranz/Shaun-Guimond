"use strict";function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){_defineProperty(e,t,r[t])})}return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function isImmutable(e){return!(!e||"function"!=typeof e.hasOwnProperty||!(e.hasOwnProperty("__ownerID")||e._map&&e._map.hasOwnProperty("__ownerID")))}function denormalizeImmutable(e,t,r){return Object.keys(e).reduce(function(t,n){var i=""+n;return t.has(i)?t.set(i,r(t.get(i),e[i])):t},t)}Object.defineProperty(exports,"__esModule",{value:!0});var getDefaultGetId=function(e){return function(t){return isImmutable(t)?t.get(e):t[e]}},EntitySchema=function(){function e(e,t,r){if(void 0===t&&(t={}),void 0===r&&(r={}),!e||"string"!=typeof e)throw new Error("Expected a string key for Entity, but found "+e+".");var n=r,i=n.idAttribute,o=void 0===i?"id":i,a=n.mergeStrategy,u=void 0===a?function(e,t){return _objectSpread({},e,t)}:a,c=n.processStrategy,s=void 0===c?function(e){return _objectSpread({},e)}:c;this._key=e,this._getId="function"==typeof o?o:getDefaultGetId(o),this._idAttribute=o,this._mergeStrategy=u,this._processStrategy=s,this.define(t)}var t=e.prototype;return t.define=function(e){this.schema=Object.keys(e).reduce(function(t,r){var n,i=e[r];return _objectSpread({},t,((n={})[r]=i,n))},this.schema||{})},t.getId=function(e,t,r){return this._getId(e,t,r)},t.merge=function(e,t){return this._mergeStrategy(e,t)},t.normalize=function(e,t,r,n,i,o){var a=this;if(o.some(function(t){return t===e}))return this.getId(e,t,r);o.push(e);var u=this._processStrategy(e,t,r);return Object.keys(this.schema).forEach(function(e){if(u.hasOwnProperty(e)&&"object"==typeof u[e]){var t=a.schema[e];u[e]=n(u[e],u,e,t,i,o)}}),i(this,u,e,t,r),this.getId(e,t,r)},t.denormalize=function(e,t){var r=this;return isImmutable(e)?denormalizeImmutable(this.schema,e,t):(Object.keys(this.schema).forEach(function(n){if(e.hasOwnProperty(n)){var i=r.schema[n];e[n]=t(e[n],i)}}),e)},_createClass(e,[{key:"key",get:function(){return this._key}},{key:"idAttribute",get:function(){return this._idAttribute}}]),e}(),PolymorphicSchema=function(){function e(e,t){t&&(this._schemaAttribute="string"==typeof t?function(e){return e[t]}:t),this.define(e)}var t=e.prototype;return t.define=function(e){this.schema=e},t.getSchemaAttribute=function(e,t,r){return!this.isSingleSchema&&this._schemaAttribute(e,t,r)},t.inferSchema=function(e,t,r){if(this.isSingleSchema)return this.schema;var n=this.getSchemaAttribute(e,t,r);return this.schema[n]},t.normalizeValue=function(e,t,r,n,i,o){var a=this.inferSchema(e,t,r);if(!a)return e;var u=n(e,t,r,a,i,o);return this.isSingleSchema||null==u?u:{id:u,schema:this.getSchemaAttribute(e,t,r)}},t.denormalizeValue=function(e,t){var r=isImmutable(e)?e.get("schema"):e.schema;return this.isSingleSchema||r?t((isImmutable(e)?e.get("id"):e.id)||e,this.isSingleSchema?this.schema:this.schema[r]):e},_createClass(e,[{key:"isSingleSchema",get:function(){return!this._schemaAttribute}}]),e}(),UnionSchema=function(e){function t(t,r){if(!r)throw new Error('Expected option "schemaAttribute" not found on UnionSchema.');return e.call(this,t,r)||this}_inheritsLoose(t,e);var r=t.prototype;return r.normalize=function(e,t,r,n,i,o){return this.normalizeValue(e,t,r,n,i,o)},r.denormalize=function(e,t){return this.denormalizeValue(e,t)},t}(PolymorphicSchema),ValuesSchema=function(e){function t(){return e.apply(this,arguments)||this}_inheritsLoose(t,e);var r=t.prototype;return r.normalize=function(e,t,r,n,i,o){var a=this;return Object.keys(e).reduce(function(t,r,u){var c,s=e[r];return null!=s?_objectSpread({},t,((c={})[r]=a.normalizeValue(s,e,r,n,i,o),c)):t},{})},r.denormalize=function(e,t){var r=this;return Object.keys(e).reduce(function(n,i){var o,a=e[i];return _objectSpread({},n,((o={})[i]=r.denormalizeValue(a,t),o))},{})},t}(PolymorphicSchema),validateSchema=function(e){if(Array.isArray(e)&&e.length>1)throw new Error("Expected schema definition to be a single schema, but found "+e.length+".");return e[0]},getValues=function(e){return Array.isArray(e)?e:Object.keys(e).map(function(t){return e[t]})},normalize=function(e,t,r,n,i,o,a){return e=validateSchema(e),getValues(t).map(function(t,u){return i(t,r,n,e,o,a)})},denormalize=function(e,t,r){return e=validateSchema(e),t&&t.map?t.map(function(t){return r(t,e)}):t},ArraySchema=function(e){function t(){return e.apply(this,arguments)||this}_inheritsLoose(t,e);var r=t.prototype;return r.normalize=function(e,t,r,n,i,o){var a=this;return getValues(e).map(function(e,u){return a.normalizeValue(e,t,r,n,i,o)}).filter(function(e){return null!=e})},r.denormalize=function(e,t){var r=this;return e&&e.map?e.map(function(e){return r.denormalizeValue(e,t)}):e},t}(PolymorphicSchema),_normalize=function(e,t,r,n,i,o,a){var u=_objectSpread({},t);return Object.keys(e).forEach(function(r){var n=e[r],c=i(t[r],t,r,n,o,a);null==c?delete u[r]:u[r]=c}),u},_denormalize=function(e,t,r){if(isImmutable(t))return denormalizeImmutable(e,t,r);var n=_objectSpread({},t);return Object.keys(e).forEach(function(t){null!=n[t]&&(n[t]=r(n[t],e[t]))}),n},ObjectSchema=function(){function e(e){this.define(e)}var t=e.prototype;return t.define=function(e){this.schema=Object.keys(e).reduce(function(t,r){var n,i=e[r];return _objectSpread({},t,((n={})[r]=i,n))},this.schema||{})},t.normalize=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return _normalize.apply(void 0,[this.schema].concat(t))},t.denormalize=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return _denormalize.apply(void 0,[this.schema].concat(t))},e}(),visit=function e(t,r,n,i,o,a){return"object"==typeof t&&t?"object"!=typeof i||i.normalize&&"function"==typeof i.normalize?i.normalize(t,r,n,e,o,a):(Array.isArray(i)?normalize:_normalize)(i,t,r,n,e,o,a):t},addEntities=function(e){return function(t,r,n,i,o){var a=t.key,u=t.getId(n,i,o);a in e||(e[a]={});var c=e[a][u];e[a][u]=c?t.merge(c,r):r}},schema={Array:ArraySchema,Entity:EntitySchema,Object:ObjectSchema,Union:UnionSchema,Values:ValuesSchema},normalize$1=function(e,t){if(!e||"object"!=typeof e)throw new Error('Unexpected input given to normalize. Expected type to be "object", found "'+typeof e+'".');var r={},n=addEntities(r);return{entities:r,result:visit(e,e,null,t,n,[])}},unvisitEntity=function(e,t,r,n,i){var o=n(e,t);if("object"!=typeof o||null===o)return o;if(i[t.key]||(i[t.key]={}),!i[t.key][e]){var a=isImmutable(o)?o:_objectSpread({},o);i[t.key][e]=a,i[t.key][e]=t.denormalize(a,r)}return i[t.key][e]},getUnvisit=function(e){var t={},r=getEntities(e);return function e(n,i){return"object"!=typeof i||i.denormalize&&"function"==typeof i.denormalize?null==n?n:i instanceof EntitySchema?unvisitEntity(n,i,e,r,t):i.denormalize(n,e):(Array.isArray(i)?denormalize:_denormalize)(i,n,e)}},getEntities=function(e){var t=isImmutable(e);return function(r,n){var i=n.key;return"object"==typeof r?r:t?e.getIn([i,r.toString()]):e[i]&&e[i][r]}},denormalize$1=function(e,t,r){if(void 0!==e)return getUnvisit(r)(e,t)};exports.denormalize=denormalize$1,exports.normalize=normalize$1,exports.schema=schema;
