define(["exports"],function(e){"use strict";function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){r(e,t,n[t])})}return e}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function u(e){return!(!e||"function"!=typeof e.hasOwnProperty||!(e.hasOwnProperty("__ownerID")||e._map&&e._map.hasOwnProperty("__ownerID")))}function c(e,t,n){return Object.keys(e).reduce(function(t,r){var i=""+r;return t.has(i)?t.set(i,n(t.get(i),e[i])):t},t)}var a=function(e){return function(t){return u(t)?t.get(e):t[e]}},f=function(){function e(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n={}),!e||"string"!=typeof e)throw new Error("Expected a string key for Entity, but found "+e+".");var r=n,o=r.idAttribute,u=void 0===o?"id":o,c=r.mergeStrategy,f=void 0===c?function(e,t){return i({},e,t)}:c,s=r.processStrategy,h=void 0===s?function(e){return i({},e)}:s;this._key=e,this._getId="function"==typeof u?u:a(u),this._idAttribute=u,this._mergeStrategy=f,this._processStrategy=h,this.define(t)}var t=e.prototype;return t.define=function(e){this.schema=Object.keys(e).reduce(function(t,n){var r,o=e[n];return i({},t,((r={})[n]=o,r))},this.schema||{})},t.getId=function(e,t,n){return this._getId(e,t,n)},t.merge=function(e,t){return this._mergeStrategy(e,t)},t.normalize=function(e,t,n,r,i,o){var u=this;if(o.some(function(t){return t===e}))return this.getId(e,t,n);o.push(e);var c=this._processStrategy(e,t,n);return Object.keys(this.schema).forEach(function(e){if(c.hasOwnProperty(e)&&"object"==typeof c[e]){var t=u.schema[e];c[e]=r(c[e],c,e,t,i,o)}}),i(this,c,e,t,n),this.getId(e,t,n)},t.denormalize=function(e,t){var n=this;return u(e)?c(this.schema,e,t):(Object.keys(this.schema).forEach(function(r){if(e.hasOwnProperty(r)){var i=n.schema[r];e[r]=t(e[r],i)}}),e)},n(e,[{key:"key",get:function(){return this._key}},{key:"idAttribute",get:function(){return this._idAttribute}}]),e}(),s=function(){function e(e,t){t&&(this._schemaAttribute="string"==typeof t?function(e){return e[t]}:t),this.define(e)}var t=e.prototype;return t.define=function(e){this.schema=e},t.getSchemaAttribute=function(e,t,n){return!this.isSingleSchema&&this._schemaAttribute(e,t,n)},t.inferSchema=function(e,t,n){if(this.isSingleSchema)return this.schema;var r=this.getSchemaAttribute(e,t,n);return this.schema[r]},t.normalizeValue=function(e,t,n,r,i,o){var u=this.inferSchema(e,t,n);if(!u)return e;var c=r(e,t,n,u,i,o);return this.isSingleSchema||null==c?c:{id:c,schema:this.getSchemaAttribute(e,t,n)}},t.denormalizeValue=function(e,t){var n=u(e)?e.get("schema"):e.schema;return this.isSingleSchema||n?t((u(e)?e.get("id"):e.id)||e,this.isSingleSchema?this.schema:this.schema[n]):e},n(e,[{key:"isSingleSchema",get:function(){return!this._schemaAttribute}}]),e}(),h=function(e){function t(t,n){if(!n)throw new Error('Expected option "schemaAttribute" not found on UnionSchema.');return e.call(this,t,n)||this}o(t,e);var n=t.prototype;return n.normalize=function(e,t,n,r,i,o){return this.normalizeValue(e,t,n,r,i,o)},n.denormalize=function(e,t){return this.denormalizeValue(e,t)},t}(s),l=function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var n=t.prototype;return n.normalize=function(e,t,n,r,o,u){var c=this;return Object.keys(e).reduce(function(t,n,a){var f,s=e[n];return null!=s?i({},t,((f={})[n]=c.normalizeValue(s,e,n,r,o,u),f)):t},{})},n.denormalize=function(e,t){var n=this;return Object.keys(e).reduce(function(r,o){var u,c=e[o];return i({},r,((u={})[o]=n.denormalizeValue(c,t),u))},{})},t}(s),y=function(e){if(Array.isArray(e)&&e.length>1)throw new Error("Expected schema definition to be a single schema, but found "+e.length+".");return e[0]},m=function(e){return Array.isArray(e)?e:Object.keys(e).map(function(t){return e[t]})},p=function(e,t,n,r,i,o,u){return e=y(e),m(t).map(function(t,c){return i(t,n,r,e,o,u)})},d=function(e,t,n){return e=y(e),t&&t.map?t.map(function(t){return n(t,e)}):t},v=function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var n=t.prototype;return n.normalize=function(e,t,n,r,i,o){var u=this;return m(e).map(function(e,c){return u.normalizeValue(e,t,n,r,i,o)}).filter(function(e){return null!=e})},n.denormalize=function(e,t){var n=this;return e&&e.map?e.map(function(e){return n.denormalizeValue(e,t)}):e},t}(s),b=function(e,t,n,r,o,u,c){var a=i({},t);return Object.keys(e).forEach(function(n){var r=e[n],i=o(t[n],t,n,r,u,c);null==i?delete a[n]:a[n]=i}),a},g=function(e,t,n){if(u(t))return c(e,t,n);var r=i({},t);return Object.keys(e).forEach(function(t){null!=r[t]&&(r[t]=n(r[t],e[t]))}),r},z=function e(t,n,r,i,o,u){return"object"==typeof t&&t?"object"!=typeof i||i.normalize&&"function"==typeof i.normalize?i.normalize(t,n,r,e,o,u):(Array.isArray(i)?p:b)(i,t,n,r,e,o,u):t},j={Array:v,Entity:f,Object:function(){function e(e){this.define(e)}var t=e.prototype;return t.define=function(e){this.schema=Object.keys(e).reduce(function(t,n){var r,o=e[n];return i({},t,((r={})[n]=o,r))},this.schema||{})},t.normalize=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return b.apply(void 0,[this.schema].concat(t))},t.denormalize=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return g.apply(void 0,[this.schema].concat(t))},e}(),Union:h,Values:l},k=function(e){var t={},n=O(e);return function e(r,o){return"object"!=typeof o||o.denormalize&&"function"==typeof o.denormalize?null==r?r:o instanceof f?function(e,t,n,r,o){var c=r(e,t);if("object"!=typeof c||null===c)return c;if(o[t.key]||(o[t.key]={}),!o[t.key][e]){var a=u(c)?c:i({},c);o[t.key][e]=a,o[t.key][e]=t.denormalize(a,n)}return o[t.key][e]}(r,o,e,n,t):o.denormalize(r,e):(Array.isArray(o)?d:g)(o,r,e)}},O=function(e){var t=u(e);return function(n,r){var i=r.key;return"object"==typeof n?n:t?e.getIn([i,n.toString()]):e[i]&&e[i][n]}};e.denormalize=function(e,t,n){if(void 0!==e)return k(n)(e,t)},e.normalize=function(e,t){if(!e||"object"!=typeof e)throw new Error('Unexpected input given to normalize. Expected type to be "object", found "'+typeof e+'".');var n={},r=function(e){return function(t,n,r,i,o){var u=t.key,c=t.getId(r,i,o);u in e||(e[u]={});var a=e[u][c];e[u][c]=a?t.merge(a,n):n}}(n);return{entities:n,result:z(e,e,null,t,r,[])}},e.schema=j,Object.defineProperty(e,"__esModule",{value:!0})});
